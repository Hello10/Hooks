{"version":3,"file":"index.esm.js","sources":["../src/Singleton.ts","../src/useStateBlob.ts"],"sourcesContent":["import React from 'react';\n\nexport type SingletonOptions<State> = {\n  state?: Partial<State> | (()=> Partial<State>);\n  [k: string]: unknown;\n}\n\nexport class Singleton<State> {\n  private static instance: any;\n  protected state: State;\n  protected options: SingletonOptions<State>;\n  protected listeners: ((state: State)=> void)[];\n\n  static use<State> (options: SingletonOptions<State> = {}): Singleton<State> {\n    if (!this.instance) {\n      this.instance = new this(options);\n    }\n    const {instance} = this;\n    const [, setState] = React.useState<State>();\n    React.useEffect(()=> {\n      let is_mounted = true;\n      function setStateIfMounted (state: State) {\n        if (is_mounted) {\n          setState(state);\n        }\n      }\n      instance.addListener(setStateIfMounted);\n      return ()=> {\n        is_mounted = false;\n        instance.removeListener(setStateIfMounted);\n      };\n    }, []);\n    return instance;\n  }\n\n  constructor (options: SingletonOptions<State> = {}) {\n    if ((this.constructor as typeof Singleton).instance) {\n      throw new Error(\"Don't call singleton constructor directly\");\n    }\n\n    this.options = options;\n    this.listeners = [];\n\n    let state = {};\n    const {state: o_state} = options;\n    if (o_state) {\n      if (typeof o_state === 'function') {\n        state = o_state();\n      } else {\n        state = o_state;\n      }\n    }\n\n    this.state = this.initialize(state);\n  }\n\n  initialize (state: Partial<State>): State {\n    return state as State;\n  }\n\n  setState (state: Partial<State>): void {\n    this.state = {\n      ...this.state,\n      ...state\n    };\n\n    for (const listener of this.listeners) {\n      listener(this.state);\n    }\n  }\n\n  addListener (listener: (state: any)=> void): void {\n    this.listeners.push(listener);\n  }\n\n  removeListener (listener: (state: any)=> void): void {\n    this.listeners = this.listeners.filter((l)=> l !== listener);\n  }\n}\n\nexport default Singleton;\n","import React, {useReducer} from 'react';\n\nexport function useStateBlob<State> (initial: State): [State, React.Dispatch<State>] {\n  return useReducer((state: State, delta: Partial<State>)=> {\n    return {\n      ...state,\n      ...delta\n    };\n  }, initial);\n}\n\nexport default useStateBlob;\n"],"names":["Singleton","use","options","instance","setState","React","useState","useEffect","is_mounted","setStateIfMounted","state","addListener","removeListener","constructor","listeners","Error","o_state","initialize","listener","push","filter","l","useStateBlob","initial","useReducer","delta"],"mappings":";;;;;;;;;;;;;;;;;;;;MAOaA;AAMD,SAAHC,GAAG,CAASC,UAAmC,EAA5C;AACR,QAAI,CAAC,KAAKC,QAAV,EAAoB;AAClB,WAAKA,QAAL,GAAgB,IAAI,IAAJ,CAASD,OAAT,CAAhB;AACD;;AACD,UAAM;AAACC,MAAAA;AAAD,QAAa,IAAnB;AACA,UAAM,GAAGC,QAAH,IAAeC,KAAK,CAACC,QAAN,EAArB;AACAD,IAAAA,KAAK,CAACE,SAAN,CAAgB;AACd,UAAIC,UAAU,GAAG,IAAjB;;AACA,eAASC,iBAAT,CAA4BC,KAA5B;AACE,YAAIF,UAAJ,EAAgB;AACdJ,UAAAA,QAAQ,CAACM,KAAD,CAAR;AACD;AACF;;AACDP,MAAAA,QAAQ,CAACQ,WAAT,CAAqBF,iBAArB;AACA,aAAO;AACLD,QAAAA,UAAU,GAAG,KAAb;AACAL,QAAAA,QAAQ,CAACS,cAAT,CAAwBH,iBAAxB;AACD,OAHD;AAID,KAZD,EAYG,EAZH;AAaA,WAAON,QAAP;AACD;;AAEDU,EAAAA,YAAaX,UAAmC;SA1BtCQ;SACAR;SACAY;;AAyBR,QAAK,KAAKD,WAAL,CAAsCV,QAA3C,EAAqD;AACnD,YAAM,IAAIY,KAAJ,CAAU,2CAAV,CAAN;AACD;;AAED,SAAKb,OAAL,GAAeA,OAAf;AACA,SAAKY,SAAL,GAAiB,EAAjB;AAEA,QAAIJ,KAAK,GAAG,EAAZ;AACA,UAAM;AAACA,MAAAA,KAAK,EAAEM;AAAR,QAAmBd,OAAzB;;AACA,QAAIc,OAAJ,EAAa;AACX,UAAI,OAAOA,OAAP,KAAmB,UAAvB,EAAmC;AACjCN,QAAAA,KAAK,GAAGM,OAAO,EAAf;AACD,OAFD,MAEO;AACLN,QAAAA,KAAK,GAAGM,OAAR;AACD;AACF;;AAED,SAAKN,KAAL,GAAa,KAAKO,UAAL,CAAgBP,KAAhB,CAAb;AACD;;AAEDO,EAAAA,UAAU,CAAEP,KAAF;AACR,WAAOA,KAAP;AACD;;AAEDN,EAAAA,QAAQ,CAAEM,KAAF;AACN,SAAKA,KAAL,gBACK,KAAKA,KADV,EAEKA,KAFL;;AAKA,SAAK,MAAMQ,QAAX,IAAuB,KAAKJ,SAA5B,EAAuC;AACrCI,MAAAA,QAAQ,CAAC,KAAKR,KAAN,CAAR;AACD;AACF;;AAEDC,EAAAA,WAAW,CAAEO,QAAF;AACT,SAAKJ,SAAL,CAAeK,IAAf,CAAoBD,QAApB;AACD;;AAEDN,EAAAA,cAAc,CAAEM,QAAF;AACZ,SAAKJ,SAAL,GAAiB,KAAKA,SAAL,CAAeM,MAAf,CAAuBC,CAAD,IAAMA,CAAC,KAAKH,QAAlC,CAAjB;AACD;;;AAtEUlB,UACIG;;SCNDmB,aAAqBC;AACnC,SAAOC,UAAU,CAAC,CAACd,KAAD,EAAee,KAAf;AAChB,wBACKf,KADL,EAEKe,KAFL;AAID,GALgB,EAKdF,OALc,CAAjB;AAMD;;;;"}