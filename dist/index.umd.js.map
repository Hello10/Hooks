{"version":3,"file":"index.umd.js","sources":["../src/Singleton.ts","../src/useStateBlob.ts"],"sourcesContent":["import React from 'react';\n\nexport type SingletonOptions<State> = {\n  state?: Partial<State> | (()=> Partial<State>);\n  [k: string]: unknown;\n}\n\nexport class Singleton<State> {\n  private static instance: any;\n  protected state: State;\n  protected options: SingletonOptions<State>;\n  protected listeners: ((state: State)=> void)[];\n\n  static use<State> (options: SingletonOptions<State> = {}): Singleton<State> {\n    if (!this.instance) {\n      this.instance = new this(options);\n    }\n    const {instance} = this;\n    const [, setState] = React.useState<State>();\n    React.useEffect(()=> {\n      let is_mounted = true;\n      function setStateIfMounted (state: State) {\n        if (is_mounted) {\n          setState(state);\n        }\n      }\n      instance.addListener(setStateIfMounted);\n      return ()=> {\n        is_mounted = false;\n        instance.removeListener(setStateIfMounted);\n      };\n    }, []);\n    return instance;\n  }\n\n  constructor (options: SingletonOptions<State> = {}) {\n    if ((this.constructor as typeof Singleton).instance) {\n      throw new Error(\"Don't call singleton constructor directly\");\n    }\n\n    this.options = options;\n    this.listeners = [];\n\n    let state = {};\n    const {state: o_state} = options;\n    if (o_state) {\n      if (typeof o_state === 'function') {\n        state = o_state();\n      } else {\n        state = o_state;\n      }\n    }\n\n    this.state = this.initialize(state);\n  }\n\n  initialize (state: Partial<State>): State {\n    return state as State;\n  }\n\n  setState (state: Partial<State>): void {\n    this.state = {\n      ...this.state,\n      ...state\n    };\n\n    for (const listener of this.listeners) {\n      listener(this.state);\n    }\n  }\n\n  addListener (listener: (state: any)=> void): void {\n    this.listeners.push(listener);\n  }\n\n  removeListener (listener: (state: any)=> void): void {\n    this.listeners = this.listeners.filter((l)=> l !== listener);\n  }\n}\n\nexport default Singleton;\n","import React, {useReducer} from 'react';\n\nexport function useStateBlob<State> (initial: State): [State, React.Dispatch<State>] {\n  return useReducer((state: State, delta: Partial<State>)=> {\n    return {\n      ...state,\n      ...delta\n    };\n  }, initial);\n}\n\nexport default useStateBlob;\n"],"names":["Singleton","use","options","instance","setState","React","useState","useEffect","is_mounted","setStateIfMounted","state","addListener","removeListener","constructor","listeners","Error","o_state","initialize","listener","push","filter","l","useStateBlob","initial","useReducer","delta"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;QAOaA;EAMD,SAAHC,GAAG,CAASC,UAAmC,EAA5C;EACR,QAAI,CAAC,KAAKC,QAAV,EAAoB;EAClB,WAAKA,QAAL,GAAgB,IAAI,IAAJ,CAASD,OAAT,CAAhB;EACD;;EACD,UAAM;EAACC,MAAAA;EAAD,QAAa,IAAnB;EACA,UAAM,GAAGC,QAAH,IAAeC,yBAAK,CAACC,QAAN,EAArB;EACAD,IAAAA,yBAAK,CAACE,SAAN,CAAgB;EACd,UAAIC,UAAU,GAAG,IAAjB;;EACA,eAASC,iBAAT,CAA4BC,KAA5B;EACE,YAAIF,UAAJ,EAAgB;EACdJ,UAAAA,QAAQ,CAACM,KAAD,CAAR;EACD;EACF;;EACDP,MAAAA,QAAQ,CAACQ,WAAT,CAAqBF,iBAArB;EACA,aAAO;EACLD,QAAAA,UAAU,GAAG,KAAb;EACAL,QAAAA,QAAQ,CAACS,cAAT,CAAwBH,iBAAxB;EACD,OAHD;EAID,KAZD,EAYG,EAZH;EAaA,WAAON,QAAP;EACD;;EAEDU,EAAAA,YAAaX,UAAmC;WA1BtCQ;WACAR;WACAY;;EAyBR,QAAK,KAAKD,WAAL,CAAsCV,QAA3C,EAAqD;EACnD,YAAM,IAAIY,KAAJ,CAAU,2CAAV,CAAN;EACD;;EAED,SAAKb,OAAL,GAAeA,OAAf;EACA,SAAKY,SAAL,GAAiB,EAAjB;EAEA,QAAIJ,KAAK,GAAG,EAAZ;EACA,UAAM;EAACA,MAAAA,KAAK,EAAEM;EAAR,QAAmBd,OAAzB;;EACA,QAAIc,OAAJ,EAAa;EACX,UAAI,OAAOA,OAAP,KAAmB,UAAvB,EAAmC;EACjCN,QAAAA,KAAK,GAAGM,OAAO,EAAf;EACD,OAFD,MAEO;EACLN,QAAAA,KAAK,GAAGM,OAAR;EACD;EACF;;EAED,SAAKN,KAAL,GAAa,KAAKO,UAAL,CAAgBP,KAAhB,CAAb;EACD;;EAEDO,EAAAA,UAAU,CAAEP,KAAF;EACR,WAAOA,KAAP;EACD;;EAEDN,EAAAA,QAAQ,CAAEM,KAAF;EACN,SAAKA,KAAL,gBACK,KAAKA,KADV,EAEKA,KAFL;;EAKA,SAAK,MAAMQ,QAAX,IAAuB,KAAKJ,SAA5B,EAAuC;EACrCI,MAAAA,QAAQ,CAAC,KAAKR,KAAN,CAAR;EACD;EACF;;EAEDC,EAAAA,WAAW,CAAEO,QAAF;EACT,SAAKJ,SAAL,CAAeK,IAAf,CAAoBD,QAApB;EACD;;EAEDN,EAAAA,cAAc,CAAEM,QAAF;EACZ,SAAKJ,SAAL,GAAiB,KAAKA,SAAL,CAAeM,MAAf,CAAuBC,CAAD,IAAMA,CAAC,KAAKH,QAAlC,CAAjB;EACD;;;EAtEUlB,UACIG;;WCNDmB,aAAqBC;EACnC,SAAOC,gBAAU,CAAC,CAACd,KAAD,EAAee,KAAf;EAChB,wBACKf,KADL,EAEKe,KAFL;EAID,GALgB,EAKdF,OALc,CAAjB;EAMD;;;;;;;;;"}